#Тестовое задание по Wordpress

```
Цель

Развернуть демо сайт на WordPress и внести доработки в тему, связанные с версткой и
программированием.

1. Базовая установка
Установить чистый WordPress на любом хостинге
Подключить бесплатную тему Astra https://wordpress.org/themes/astra/
Установить плагин Elementor

```

Итак, мы развернули сайт в подпапку моего домена https://cwteam.ru/test3/
Установили тему Астра
Установили стартер с темой земля Earth
Установили Элементатор
После установки с Элементатором возникли проблемы (он не хотел грузится - известная проблема) - пришлось изменить конфигурацию сервера

```htaccess
php_value memory_limit 512M
php_value max_execution_time 300
php_value upload_max_filesize 64M
php_value post_max_size 64M
```

Теперь Элементатор отлично работает. Идем дальше по ТЗ!

```
Задача по верстке

Необходимо переработать мобильное меню.
Мобильное меню должно выглядеть и работать по логике как на сайте клиента https://detect-wasserschadensanierung.de/

Требования к меню
Меню должно выезжать сбоку экрана
Меню должно закрываться при клике на затемненную область вне меню
Одна из ссылок должна раскрывать подменю как на примере

https://skr.sh/sZuAH9EoDwv

Допускается использование собственного CSS, JS и правок в теме.
Важно показать понимание адаптивной верстки и работы с DOM.
```

Что же начнем создания темы astra-child, так как не хотим менять ядро темы и иметь проблем.
Код самой дочерней темы лежит в этом репозитории и можно посмотреть все файлы.

Создаем парку astra-child в папке с темами. Создаем style.css

```css
/*
Theme Name: Astra Child
Template: astra
Version: 1.0.0
*/
```
С к примеру таким заголовком. Готово! Мы создали дочернюю тему и теперь можем править код небоясь, что при обновлении темы с ним что-то случится.

Задача у нас для мобильного меню. Тема уже привязала переключение и оно выезжает вниз. В про теме если верить
описанию есть настройки, которые могут помочь просто изменить направление движения, но у нас бесплатная тема - делаем сами.

Создаем файл functions.php.

Расскрытие ссылки в нашей теме уже есть - просто настроим меню и затащим изначальную страницу Example и вложенность появляется сама.
Теперь нам нужно доработать стили и классы - не люблю aditionall css в темах, мне приятнее по старинке править файлы - это и быстрее и 
на мой взгляд профессиональнее.

```php
add_action('wp_enqueue_scripts', 'astra_child_enqueue_styles');
function astra_child_enqueue_styles() {

    // Стили родительской темы
    wp_enqueue_style(
        'astra-parent-style',
        get_template_directory_uri() . '/style.css',
        array(),
        wp_get_theme(get_template())->get('Version')
    );

    // Стили дочерней темы
    wp_enqueue_style(
        'astra-child-style',
        get_stylesheet_directory_uri() . '/style.css',
        array('astra-parent-style'),
        wp_get_theme()->get('Version')
    );

    wp_enqueue_style('dashicons');
}
```

Добавляем файл стилей дочерней, родительской темы. Также добавим дашиконки - это понадобится позже.

```php
/**
 * Подключение скриптов
 */
add_action('wp_enqueue_scripts', 'astra_child_enqueue_scripts');
function astra_child_enqueue_scripts() {

    // Кастомный JS
    wp_enqueue_script(
        'astra-child-script',
        get_stylesheet_directory_uri() . '/js/custom.js',
        array('jquery'),
        '1.0.0',
        true
    );
}
```

Подключаем файл для скриптов. 

Итак стилями делаем смещение для планшетов и мобильных меню за экран и затемнение при вызове.
В скриптах осуществляем сворачивание разворачивание, а так же пишем функцию для сворачивания при клике на затемнение.
Маленькая тонкость - что бы сбросить события темы - что бы не вносить правок, хотя наверно можно было
отключить файл в котором это описывается и поправить его в дочерней теме, но я подумал, что это может 
привести к потере функционала при обновлении, потому мы делаем хитрее - мы пересоздаем кнопку заново и вешаем
на нее свое событие клика, которые и заставляет кнопку делать то, что нам надо. Готово!

И так идем дальше!

```
Задача по программированию

Создать отдельную страницу FAQ.

Что нужно сделать

Создать страницу с адресом /faq или /help
В файле functions.php задать массив вопросов и ответов (минимум 5 штук)
Вывести эти вопросы и ответы на странице в виде аккордеона
При клике на вопрос раскрывается ответ
Логика раскрытия и кнопок должна работать через JavaScript
Данные вопросов и ответов должны браться из PHP массива, а не быть прописаны напрямую в HTML

Важно, чтобы решение было реализовано через структуру WordPress (functions.php, шаблоны, хуки), а не просто вставкой готового HTML блока в редакторе.
```

Отлично! Задача поинтереснее, но я позволил ее себе чуть чуть усложнить и уйти от процедурного программирования. Да вордпресс не слишком то приспособлен для ООП, 
но с парой костылей и тут его можно реализовывать!

```php
// Подключаем класс ДО инициализации
require_once get_stylesheet_directory() . '/includes/class-faq-manager.php';

// Initialize FAQ Manager - ИНИЦИАЛИЗИРУЕМ СРАЗУ!
$faq_manager_instance = FAQ_Manager::get_instance();
```

Вот такая маленькая вставка и мы уже не захламляем functions.php - Он у нас 77 строк всего!
Что мы тут делаем? Конечно подключаем наш замечательный класс и через синглтон вызываем его инстанс,
это что бы не клонился и не вызывался дважды. Всегда будет вызыван только один, что бы не произошло.

Итак в ТЗ есть:

```
В файле functions.php задать массив вопросов и ответов (минимум 5 штук)
```

Но мне стало скучно и в моем классе я задал дефолтные значения, но также зарегестрировал хуки для
админки и создал интерфейс добавления новых вопросов. Полноценный Круд с закладкой в меню в Wordpress!

Теперь мы на лету можем править, добавлять и удалять новые вопросы! Так же интереснее верно?

```php
    private function init_hooks() {
        // Admin menu
        add_action('admin_menu', array($this, 'add_admin_menu'));
        add_action('admin_init', array($this, 'register_settings'));

        // AJAX
        add_action('wp_ajax_add_faq_question', array($this, 'handle_ajax_add_question'));
        add_action('wp_ajax_remove_faq_question', array($this, 'handle_ajax_remove_question'));

        // Scripts
        add_action('wp_enqueue_scripts', array($this, 'enqueue_scripts'));

        // Shortcode
        add_shortcode('faq_accordion', array($this, 'render_shortcode'));

        // Auto insert on FAQ page (безопасная версия)
        add_filter('the_content', array($this, 'auto_insert_on_faq_page'), 100);
    }
```

Метод класса с хуками!

Мне подумалось создавать класс ради одного шорткода будет глупо. Потому я осуществил три варианта использования класса.

```
page-faq.php
```

Это шаблон для страницы с шорткодом, его можно выбрать для страницы и выведет наш FAQ.

Так же мой класс автоматически добавляет этот блок для страниц '/faq' и '/help' если они есть. То есть достаточно задать алиас. Страницы '/help' нет, только /faq.

Так же можно просто вызвать шорткод в любом месте темы:

```shortcode
[faq_accordion]
```

```php
echo do_shortcode('[faq_accordion]');
```

Что же, в классе также добавлены еще два файл стилей и классов, что бы не добавлять их каждой странице,
а только где есть faq.

Немного javascript и вот у нас акардеон и маленький бонус - фильтрация через строку поиска!

Спасибо за внимание!